<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Scope &amp; Context | Ge Yulong</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="JavaScript对于作用域(Scope) 和 上下文(Context)的实现是这门语言的一个非常独到的地方，部分归功于其独特的灵活性。函数可以接收不同的上下文和作用域。这些概念为Javascript中的很多强大的设计模式提供了坚实的基础。然而这些概念非常容易给开发人员带来困惑。">
<meta name="keywords" content="JavaScript,Scope,Context">
<meta property="og:type" content="article">
<meta property="og:title" content="Scope &amp; Context">
<meta property="og:url" content="http://yulongge.github.io/2016/12/21/Scope-Context/index.html">
<meta property="og:site_name" content="Ge Yulong">
<meta property="og:description" content="JavaScript对于作用域(Scope) 和 上下文(Context)的实现是这门语言的一个非常独到的地方，部分归功于其独特的灵活性。函数可以接收不同的上下文和作用域。这些概念为Javascript中的很多强大的设计模式提供了坚实的基础。然而这些概念非常容易给开发人员带来困惑。">
<meta property="og:image" content="http://yulongge.github.io/2016/12/21/Scope-Context/scope.png">
<meta property="og:updated_time" content="2017-06-13T15:51:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Scope &amp; Context">
<meta name="twitter:description" content="JavaScript对于作用域(Scope) 和 上下文(Context)的实现是这门语言的一个非常独到的地方，部分归功于其独特的灵活性。函数可以接收不同的上下文和作用域。这些概念为Javascript中的很多强大的设计模式提供了坚实的基础。然而这些概念非常容易给开发人员带来困惑。">
<meta name="twitter:image" content="http://yulongge.github.io/2016/12/21/Scope-Context/scope.png">
  
    <link rel="alternate" href="/atom.xml" title="Ge Yulong" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Ge Yulong</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">web</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yulongge.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Scope-Context" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/21/Scope-Context/" class="article-date">
  <time datetime="2016-12-21T06:01:50.000Z" itemprop="datePublished">2016-12-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Scope &amp; Context
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>JavaScript对于作用域(Scope) 和 上下文(Context)的实现是这门语言的一个非常独到的地方，部分归功于其独特的灵活性。函数可以接收不同的上下文和作用域。这些概念为Javascript中的很多强大的设计模式提供了坚实的基础。然而这些概念非常容易给开发人员带来困惑。<br><a id="more"></a><br>首先要知道，上下文和作用域是两个完全不同的概念。多年来，开发者会混淆这两个概念，本人到现在还没有清醒。。。<br>函数的每次调用都有与之紧密相关的作用域和上下文，从根本上说：</p>
<ul>
<li>作用域是基于函数的，作用域涉及到所被调用函数中的变量访问，并且不同的调用场景是不一样的</li>
<li>上下文是基于对象的，上下文始终是this关键字的值，它是拥有(控制)当前所执行代码的对象的引用</li>
</ul>
<h3 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a>变量作用域</h3><p>一个变量可以被定义在局部或者全局作用域中，这建立了运行时(runtime)期间变量的访问性的不同作用域范围。任何被定义的全局变量，意味着它需要在函数体的外部被声明，并且存活于整个运行时，并且在任何作用域中都可以被访问到。<br>在ES6之前，局部变量只能存在于函数体重，并且函数的每次调用他们都拥有不同的作用域范围。局部变量只能在其被调用期间的作用域范围内被赋值，检索，操纵。</p>
<p>在ES6之前，JavaScript不支持跨级作用域，这意味着在if语句，switch语句，for循环，while循环中无法支持块级作用域。 但是从ES6开始，你可以通过let关键字来定义变量，它修正了val关键字的缺点，能够让你想java语言那样定义变量，并且支持块级作用域。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span>(<span class="literal">true</span>) &#123;</div><div class="line">    <span class="keyword">var</span> tep = <span class="number">123</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">console</span>.log(tep); <span class="comment">//123</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//之所以能够访问，是因为var关键字声明的变量有一个变量提升的过程。而在ES6中推荐使用let关键字定义变量</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span>(<span class="literal">true</span>) &#123;</div><div class="line">    <span class="keyword">let</span> tep = <span class="number">123</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">console</span>.log(tep); <span class="comment">// ReferenceError: tep is not defined</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//这种方式能够避免很多错误</span></div></pre></td></tr></table></figure>
<h3 id="this上下文"><a href="#this上下文" class="headerlink" title="this上下文"></a>this上下文</h3><p>上下文通常取决于函数是如何被调用的。当一个函数被作为对象中的一个方法被调用的时候，this被设置为调用该方法的对象上:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">     <span class="attr">foo</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">       <span class="built_in">console</span>.log(<span class="keyword">this</span> === obj);</div><div class="line">     &#125;</div><div class="line">&#125;</div><div class="line">obj.foo() <span class="comment">//true</span></div></pre></td></tr></table></figure></p>
<p>这个准则也使用于当调用函数时使用 <strong>new</strong> 操作符来创建实例的情况下。这种情况下，在函数的作用域内部this的值被设置为新创建的实例:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">new</span> foo() <span class="comment">// foo</span></div><div class="line">foo() <span class="comment">//window</span></div></pre></td></tr></table></figure></p>
<p>当调用一个为绑定函数时，this默认情况下全局上下文，在浏览器中他指向window对象。需要注意的是，ES5引入了严格模式的概念，如果启用了严格模式，此时上下文默认为 <strong>undefined</strong>;</p>
<h3 id="执行环境"><a href="#执行环境" class="headerlink" title="执行环境"></a>执行环境</h3><p>JavaScript是一个单线程语言，意味着同一时间只能执行一个任务。当JavaScript解释器初始化执行代码是，它首先默认进入全局执行环境(execution context)，从此开始，函数的每次调用都会创建一个新的执行环境。<br><strong>执行环境</strong> 它定义了变量或函数有权访问的其他数据，决定了他们各自的行为。它更偏向于作用域的作用，而不是我们我们前面讨论的上下文。</p>
<p>每个函数都有自己的执行环境。当执行流进入一个函数时，函数的环境就会被推入一个环境栈中。在函数执行完后，栈将其环境弹出，把控制权返回给之前的执行环境。<br>执行环境可以分为创建和执行两个阶段。在创建阶段，解析器首先会创建一个变量对象(variable object),也称为活动对象(activation object),它由定义在执行环境中的变量，函数声明，和参数数组。这个阶段，作用域会被初始化，this的值也会被最终确定。</p>
<h3 id="作用域链the-scope-chain"><a href="#作用域链-The-Scope-Chain" class="headerlink" title="作用域链(The Scope Chain)"></a>作用域链(The Scope Chain)</h3><p>当代码在一个环境中执行时，会创建变量对象的一个作用域链(scope chain).作用域链的用途是保证对执行环境有权限访问所有变量和函数的有序访问。作用域链包含了在环境栈中的每个执行环境对应的变量对象。通过作用域链，可以决定变量的访问和标识符的解析。</p>
<blockquote>
<p>全局执行环境的变量对象始终都是作用域链的最后一个对象</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> color = <span class="string">'blue'</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeColor</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> anotherColor = <span class="string">'red'</span>;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">swapColors</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> tempColor = anotherColor;</div><div class="line">    anotherColor = color;</div><div class="line">    color = tempColor;</div><div class="line">    <span class="comment">//这里可以访问color，anotherColor,和tempColor</span></div><div class="line">  &#125;</div><div class="line">  swapColors(); <span class="comment">//这里可以color和anotherColor,但是不能访问tempColor</span></div><div class="line">&#125;</div><div class="line">changeColor();</div><div class="line"><span class="comment">//这里只能访问color</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"color is now"</span>,color)</div></pre></td></tr></table></figure>
<p>上述代码一共包括三个执行环境: 全局环境，changeColor()的局部环境，swapColors()的局部环境。<br><img src="/2016/12/21/Scope-Context/scope.png" alt="scope_chain" title="scope_chain"></p>
<p>从上图发现。内部环境可以通过作用域链访问所有的外部环境，但是外部环境不能访问内部环境中的任何变量和函数。这些环境之间的联系是线性的，有次序的。</p>
<p>对于标识符解析(变量或者函数名搜索)是沿着作用域链一级一级地搜索标识符的过程。搜索过程始终从作用域链的前端开始，然后逐级向后(全局执行环境)回溯，直到找到标识符为止。</p>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>闭包是指有权访问另一函数作用域中变量的函数。换句话说，在函数内定义一个嵌套的函数时，就构成了一个闭包，它允许嵌套函数访问外层函数的变量，通过返回嵌套函数，允许你维护对外部函数中局部变量，参数，和内函数声明的访问。这种封装允许你在外部作用域中隐藏和保护执行环境。并且暴露公共接口，进而通过公共接口执行进一步的操作。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> localVariable = <span class="string">'private variable'</span>;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> localVariable;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> getLocalVariable = foo();</div><div class="line">getLocalVariable(); <span class="comment">//private variable</span></div></pre></td></tr></table></figure></p>
<p>模块模式最流行的闭包类型之一，它允许你模拟公共的，私有的，和特权成员</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Module = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> privateProperty = <span class="string">'foo'</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">privateMethod</span>(<span class="params">args</span>)</span>&#123;</div><div class="line">      <span class="comment">//do something</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">publicProperty</span>: <span class="string">''</span>,</div><div class="line">      <span class="attr">publicMethod</span>: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</div><div class="line">        <span class="comment">//do something</span></div><div class="line">      &#125;,</div><div class="line">    <span class="attr">privilegeMethod</span>: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> privateMethod(args);</div><div class="line">    &#125;</div><div class="line">    &#125;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<p>模块类似于一个单例对象。由于在上面的代码中我们利用了(function(){…})()的匿名函数形式，因此当编译器解析它的时候会立即执行。在闭包的执行上下文的外部唯一可以访问的对象是位于返回对象中的公共方法和属性。然而，因为执行上下文被保存的缘故，所有的私有属性和方法将一直存在于应用的整个生命周期，这意味着我们只能通过公共方法才可以与他们交互。</p>
<p>另一种类型的闭包被称为立即执行函数表达式。其实它很简单，只不过是一个在全局变量中自执行的匿名函数而已：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> foo, bar;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">private</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//do something</span></div><div class="line">  &#125;</div><div class="line">  <span class="built_in">window</span>.Module = &#123;</div><div class="line">  <span class="attr">public</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//do something</span></div><div class="line">  &#125;</div><div class="line">  &#125;</div><div class="line"> &#125;)(<span class="keyword">this</span>);</div></pre></td></tr></table></figure></p>
<p>对于保护全局命名空间免受变量污染而言，这种表达式非常有用，它通过构建函数作用域的形式变量与全局命名空间间隔，并通过闭包的形式让它们存在于整个运行时，在很多的应用和框架中，这种封装源代码的方式用处非常流行，通常都是通过暴露一个单一的全局接口的方式与外部进行交互。</p>
<h3 id="call-和-apply"><a href="#Call-和-Apply" class="headerlink" title="Call 和 Apply"></a>Call 和 Apply</h3><p>这两个方法内建在所有的函数中(它们是Function对象的原型方法)，允许你在自定义上下文中执行函数，不同点在于，call函数需要参数列表，而apply函数需要你提供一个参数数组。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> o = &#123;&#125;;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> a + b;</div><div class="line">&#125;</div><div class="line"><span class="comment">//将函数f作为o的方法，实际上就是重新设置函数f的上下文。</span></div><div class="line">f.call(o, <span class="number">1</span>, <span class="number">2</span>); <span class="comment">//3</span></div><div class="line">f.apply(o, [<span class="number">1</span>, <span class="number">2</span>]); <span class="comment">//3</span></div></pre></td></tr></table></figure>
<p>两个结果是相同的，函数f在对象o的上下文中被调用，并提供了两个相同的参数1和2</p>
<p>在ES5中引入了Function.prototype.bind方法，用于控制函数的执行上下文，他会返回一个新的函数，并且这个新的函数会被永久的绑定到bind方法的第一个参数所指定的对象上，无论该函数被如何使用，他通过闭包将函数引导到正确的上下文，对于低版本的浏览器，我们可以对他进行如下polyfill<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(!(<span class="string">'bind'</span> <span class="keyword">in</span> <span class="built_in">Function</span>.prototype)) &#123;</div><div class="line">  <span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> fn = <span class="keyword">this</span>,</div><div class="line">        context = <span class="built_in">arguments</span>[<span class="number">0</span>],</div><div class="line">        argus = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>,<span class="number">1</span>);</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">          <span class="keyword">return</span> fn.apply(context, args.concat(<span class="built_in">arguments</span>));</div><div class="line">        &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>bind()方法通常被用在上下文丢失的场景下，例如面向对象的事件处理。之所以要这么做，是因为节点的addEventListener方法总是为事件处理器所绑定的节点的上下文中国执行回调函数，这就是它应该表现的那样。但是如果你想要使用高级的面向对象技术，或者需要你的回调函数成为某个方法的实例，你将需要手动调整上下文，这就是bing方法所带了的便利之处。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyClass</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.element = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">  <span class="keyword">this</span>.element.addEventListener(<span class="string">'click'</span>,<span class="keyword">this</span>.onClick.bind(<span class="keyword">this</span>), <span class="literal">false</span>);</div><div class="line">&#125;</div><div class="line">MyClass.prototype.onClick = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">  <span class="comment">//do something</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>回顾上面的bind方法的源代码，你可能会注意到有两次调用涉及到了Array的slice方法:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</div><div class="line">[].slice.call(<span class="built_in">arguments</span>);</div></pre></td></tr></table></figure></p>
<p>我们都知道，arguments对象并不是一个真正的数组，二十一个类数组对象，虽然具有length属性，并且值也能够被索引，但是他们不支持原生的数组方法，例如slice和push。但是，由于它们具有和数组类似的行为，数组的方法能够被调用和劫持，因此我们可以通过类似上面代码的方式达到这个目的，我们可以在javascript中模拟经典继承方式：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MyClass.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">//call the superclass init method in the context of the "MyClass" instance</span></div><div class="line">  MySuperClass.prototype.init.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>也就是利用call或者apply在子类的实例中调用超类的方法</p>
<h3 id="es6的箭头函数"><a href="#ES6的箭头函数" class="headerlink" title="ES6的箭头函数"></a>ES6的箭头函数</h3><p>ES6中的箭头函数可以作为Function.prototype.bind()的替代品，和普通函数不同，箭头函数没有它自己的this值，他的this值继承自外围作用域。<br>对于普通函数而言，它总会自动接收一个this值，this的指向取决于它调用的方式<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">      <span class="attr">addAll</span>: <span class="function"><span class="keyword">function</span>(<span class="params">pieces</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">          _.each(pieces, <span class="function"><span class="keyword">function</span>(<span class="params">piece</span>) </span>&#123;</div><div class="line">                self.add(piece);</div><div class="line">              &#125;)</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在上面的例子中，最直接的想法是直接使用this.add(piece),但不幸的是，在JavaScript中你不能这样做，因为each的回调函数并未从外层继承this的值，在该回调函数中，this的值为window或者undefined，因此我们使用临时变量self将外部的this值导入内部。<br>除此之外我们还有两种方法：<br>在ES5中使用bind()方法<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">      <span class="attr">addAll</span>: <span class="function"><span class="keyword">function</span>(<span class="params">pieces</span>) </span>&#123;</div><div class="line">          _.each(pieces, <span class="function"><span class="keyword">function</span>(<span class="params">piece</span>) </span>&#123;</div><div class="line">                self.add(piece);</div><div class="line">              &#125;.bind(<span class="keyword">this</span>))</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在ES6中的箭头函数<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line"><span class="attr">addAll</span>: <span class="function"><span class="keyword">function</span>(<span class="params">pieces</span>)</span>&#123;</div><div class="line">          _.each(pieces, piece =&gt; <span class="keyword">this</span>.add(piece));</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在ES6版本中，addAll方法从它的调用者处获得了this值，内部函数是一个箭头函数，所以它集成了外部作用域的this值。</p>
<blockquote>
<p>对回调函数而言，在浏览器中，回调函数中的this为window或undefined，而在nodejs中，回调函数的this为global</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">a, callback</span>)</span>&#123;</div><div class="line">  callback(a);</div><div class="line">&#125;</div><div class="line">hello(<span class="string">'wewe'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span> === global); <span class="comment">//true</span></div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<p>参考别人的博客，写完了，但是还是没有精通。。。，理解这些概念非常重要，因为作用域和上下文在现代javascript中扮演着最基本的角色。无论我们谈论什么闭包，面向对象，继承，或者各种原生实现，上下文和作用域都在其中扮演着至关重要的角色。这是起点。。。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yulongge.github.io/2016/12/21/Scope-Context/" data-id="cj4p6o4mz001hj4s6ohx07emp" class="article-share-link">Share</a>
      
        <a href="http://yulongge.github.io/2016/12/21/Scope-Context/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Context/">Context</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Scope/">Scope</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/12/22/storage/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Storage
        
      </div>
    </a>
  
  
    <a href="/2016/12/20/memoryManagement/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">memoryManagement</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Event/">Event</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JSON/">JSON</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/web/">web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/web/JSONP/">JSONP</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/">Javascript</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/ES6/">ES6</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/ES6/Promise/">Promise</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/book/">book</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/http/https/">https</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/iTerm2/">iTerm2</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mvvm/">mvvm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/mvvm/mvc/">mvc</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/mvvm/mvc/mvp/">mvp</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/vim/">vim</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/JavaScript/">JavaScript</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/JavaScript/Promise/">Promise</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/JavaScript/css/">css</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/">webpack</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Context/">Context</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cookie/">Cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DOM/">DOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/">ES6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Event/">Event</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSONP/">JSONP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JvaScript/">JvaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Promise/">Promise</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RegExp/">RegExp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scope/">Scope</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Storage/">Storage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/URI/">URI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book/">book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/event/">event</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iTerm2/">iTerm2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mvc/">mvc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mvp/">mvp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mvvm/">mvvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruanyifeng/">ruanyifeng</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/study/">study</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/this/">this</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Context/" style="font-size: 10px;">Context</a> <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/DOM/" style="font-size: 10px;">DOM</a> <a href="/tags/ES6/" style="font-size: 10px;">ES6</a> <a href="/tags/Event/" style="font-size: 10px;">Event</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/JSONP/" style="font-size: 10px;">JSONP</a> <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/JvaScript/" style="font-size: 10px;">JvaScript</a> <a href="/tags/Promise/" style="font-size: 12.5px;">Promise</a> <a href="/tags/RegExp/" style="font-size: 12.5px;">RegExp</a> <a href="/tags/Scope/" style="font-size: 10px;">Scope</a> <a href="/tags/Storage/" style="font-size: 10px;">Storage</a> <a href="/tags/URI/" style="font-size: 12.5px;">URI</a> <a href="/tags/book/" style="font-size: 17.5px;">book</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/event/" style="font-size: 10px;">event</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/iTerm2/" style="font-size: 10px;">iTerm2</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/mvc/" style="font-size: 10px;">mvc</a> <a href="/tags/mvp/" style="font-size: 10px;">mvp</a> <a href="/tags/mvvm/" style="font-size: 10px;">mvvm</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/ruanyifeng/" style="font-size: 17.5px;">ruanyifeng</a> <a href="/tags/study/" style="font-size: 10px;">study</a> <a href="/tags/this/" style="font-size: 12.5px;">this</a> <a href="/tags/vim/" style="font-size: 12.5px;">vim</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/前端/" style="font-size: 10px;">前端</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/07/04/studyInsight/">学习心得</a>
          </li>
        
          <li>
            <a href="/2017/06/13/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/01/24/this/">this</a>
          </li>
        
          <li>
            <a href="/2017/01/23/npm/">从头开始写一个npm包</a>
          </li>
        
          <li>
            <a href="/2017/01/17/StringAPI/">String API</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Ge Yulong<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'yulongge-github-io';
  
  var disqus_url = 'http://yulongge.github.io/2016/12/21/Scope-Context/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>